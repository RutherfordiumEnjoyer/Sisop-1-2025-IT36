#!/bin/bash

if [ $# -lt 2 ]; then
    echo "Error: Missing arguments."
    echo "Use -h or --help for more information."
    exit 1
fi

file="$1"
opsi="$2"

if [ ! -f "$file" ]; then
    echo "Error: file $file not found!"
    exit 1
fi

if [ "$opsi" = "-h" ] || [ "$opsi" = "--help" ]; then
    echo "=============================================================================================================================="
    echo "‚†Ä‚†Ä‚†Ä‚†≤‚£¶‚£§‚£Ä‚£Ä‚†Ä‚†Ä‚†Ä‚£Ä‚£Ä‚£†‚£§‚£Ä‚£Ä‚†Ä‚¢Ä‚£Ä‚£†‚£§‚£∂‚£∂‚†ü‚†Ä‚†Ä‚†Ä     ‚†Ä ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä        ‚£Ä‚£Ä‚£§‚£§‚£§‚£§‚£§‚£§‚£Ä‚£Ä‚£Ä‚£Ä‚£Ä‚°Ä‚¢Ä‚£Ä‚£Ä‚£Ä‚£Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£Ä‚£Ä‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä ‚£Ä‚£Ä‚£§‚£¥‚†∂‚£¶‚†Ä"
    echo " ‚†Ä‚†Ä‚†Ä‚†Ä‚†ô‚£ø‚£ø‚£ø‚£ø‚£∑‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†ã‚†Ä‚†Ä       ‚†Ä‚†Ä‚¢Ä‚£§‚°¥‚†∂‚†∂‚†∂‚¢§‚£§‚£Ä‚†Ä‚†Ä‚£†‚£§‚†¥‚†∂‚†∂‚¢¶‚£§‚°Ä‚†Ä‚¢Ä‚£Ä‚£Ä‚£Ä‚£§‚£§‚£§‚£§‚°Ä‚†Ä‚¢Ä‚£Ä‚£Ä‚£Ä‚£§‚£§‚£§‚£§‚†Ä‚†Ä‚†Ä‚£º‚†ã‚¢ª‚°á‚†Ä‚†§‚£§‚°Ä‚†ò‚†â‚†â‚†â‚†â‚†â‚†õ‚†õ‚†â‚†â‚†â‚†ô‚†ª‚¢∂‚†ü‚†õ‚†ã‚†õ‚†õ‚†ª‚†∂‚¢¶‚£§‚£Ñ‚†Ä‚†Ä ‚¢∏‚°è‚†â‚¢Ä‚°Ä‚†Ä‚£ø‚†Ä"
    echo " ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚¢ø‚£ø‚£ø‚†ª‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†ü‚¢ª‚£ø‚£ø‚°ø‚†É‚†Ä‚†Ä‚†Ä       ‚†Ä‚£¥‚†ü‚†Å‚£Ä‚£†‚£§‚£§‚£Ä‚°à‚†ô‚¢∑‚°æ‚†ã‚†Ä‚£Ä‚£§‚£§‚£Ä‚†à‚†õ‚°ü‚†õ‚†õ‚†â‚†ô‚†á‚£†‚£Ñ‚†ò‚£ø‚°ü‚†õ‚†õ‚†â‚†π‚†Å‚£§‚°Ñ‚¢∏‚°á‚†Ä‚£º‚†É‚¢†‚†Ä‚¢ª‚£∂‚†Ä‚£ø‚£ø‚°Ä‚†Ä‚¢∏‚£ø‚°Ü‚†Ä‚£∂‚£æ‚†ü‚†õ‚†õ‚†ª‚£Ü‚†Ä‚¢∞‚°∂‚†õ‚†≥‚†∂‚¢∂‚£¶‚°§‚†Ä‚£ø‚†Ä ‚†Ä‚¢∏‚°á‚†ò‚£ø‚°á‚†Ä‚£ø‚†Ä"
    echo " ‚†Ä‚†Ä‚†Ä‚†≤‚£∂‚£∂‚£æ‚£ø‚£ø‚†Ä‚¢®‚†ô‚¢ø‚£ø‚£ø‚†è‚£Ö‚†Ä‚¢∏‚£ø‚£ø‚£∑‚£æ‚†ü‚†Å       ‚¢∞‚°è‚¢Ä‚£æ‚£ø‚°ø‚†õ‚†ª‚†ø‚†ü‚†Ä‚†Ä‚¢Ä‚£¥‚£ø‚°è‚†Å‚£¥‚†ã‚£∑‚°Ñ‚†Ä‚¢∏‚°ü‚†ª‚£Ü‚£Ä‚£ø‚£ø‚†Ä‚¢ø‚†Å‚¢∏‚†ü‚¢ª‚£Ñ‚£∞‚£ø‚£ß‚†à‚£ø‚£º‚†ã‚¢†‚°ø‚£á‚†à‚¢ø‚†Ä‚£ø‚†ò‚£∑‚°Ä‚¢∏‚£ø‚£ß‚†Ä‚†à‚£ø‚°Ñ‚¢∏‚£∑‚†Ä‚¢ø‚°Ä‚†∏‚°Ñ‚†ê‚¢∂‚£§‚£Ñ‚£à‚†Å‚£∏‚†á‚†Ä‚†Ä  ‚†à‚£á‚†Ä‚£ø‚°á‚¢∞‚°ø‚†Ä"
    echo " ‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†ª‚¢ø‚£ø‚£ø‚¢∑‚£∂‚£∂‚£æ‚£ø‚£ø‚£∂‚£∂‚£æ‚†ü‚£ø‚£ø‚£ø‚£ã‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä    ‚£æ‚°á‚¢∏‚£ø‚°è‚¢Ä‚£∂‚£¶‚£§‚£¥‚†Ä‚¢†‚°ü‚†Å‚¢ª‚°á‚†Ä‚†Å‚¢Ä‚£ø‚°á‚†Ä‚¢∏‚°á‚£†‚£ù‚¢õ‚£Å‚¢∏‚°Ü‚†∏‚†Ä‚£æ‚£Ä‚£†‚£ù‚£ã‚°Ä‚£ø‚°Ä‚¢π‚†á‚¢†‚°ø‚†Ä‚¢∏‚£Ü‚†ò‚†Ä‚£ø‚£∂‚†ø‚£ß‚¢ò‚£ø‚£ø‚†Ä‚†Ä‚£ø‚°á‚¢∏‚£ø‚†Ä‚¢∏‚°á‚¢Ä‚†ô‚¢¶‚£Ñ‚†à‚†õ‚¢ø‚£ø‚†ã‚†Ä‚†Ä‚†Ä‚†Ä  ‚£ø‚†Ä‚¢ª‚†É‚¢∏‚°á‚†Ä"
    echo " ‚†Ä‚†Ä‚¢Ä‚£Ä‚£Ä‚†ê‚¢∂‚£ø‚£ø‚£ß‚†Å‚†Ä‚†ã‚†Å‚†à‚†ã‚†Ä‚¢Ä‚£æ‚£ø‚£ø‚°ø‚£∑‚£∂‚†Ä‚†Ä‚†Ä‚†Ä    ‚¢π‚°á‚†∏‚£ø‚£á‚†à‚†ª‚†õ‚†Å‚†à‚†Ä‚¢æ‚°á‚†Ä‚†Ä‚†õ‚†∑‚†∂‚£ø‚°ø‚†Ä‚†Ä‚£º‚£ø‚°è‚†π‚°ü‚†ª‚£ø‚£ß‚†Ä‚†Ä‚£ø‚£ø‚°è‚¢ª‚†ü‚¢ª‚£ø‚£á‚†Ä‚¢Ä‚£ø‚†∑‚†∂‚†∂‚£ø‚°Ñ‚†Ä‚£ø‚£ø‚†Ä‚¢ª‚°ü‚†â‚£ø‚†Ä‚†Ä‚¢π‚°á‚†∏‚†ü‚¢Ä‚£ø‚†É‚¢∏‚£∑‚£§‚°à‚†õ‚¢¶‚°Ä‚†π‚£ß‚†Ä‚†Ä‚†Ä‚†Ä  ‚¢ø‚£Ñ‚£§‚£§‚£º‚†á‚†Ä"
    echo " ‚†Ä‚†Ä‚£º‚£ø‚£ø‚£∑‚£§‚£ô‚£ø‚£ø‚£∑‚£∂‚£∂‚£¥‚£¥‚£¥‚£∂‚£ø‚£ø‚£ø‚†ü‚£°‚£ø‚£ø‚£ß‚£Ñ‚£Ä‚°Ä    ‚†à‚£ß‚†Ä‚†π‚£ø‚£ø‚£∂‚£∂‚£ø‚†ó‚†Ä‚†∏‚£ß‚°Ä‚†Ä‚¢Ä‚£†‚°¥‚†ü‚†Å‚£∞‚†Ä‚£ø‚£ø‚°á‚¢Ä‚†Ä‚†Ä‚£ø‚£ø‚°Ñ‚†Ä‚£ø‚£ø‚†É‚°Ä‚†Ä‚†à‚£ø‚†è‚†Ä‚¢ø‚†è‚¢∞‚£∂‚°Ü‚†ò‚£ø‚†Ä‚¢ª‚£ø‚†Ä‚†Ä‚£ø‚°Ä‚£ø‚†Ä‚°Ü‚¢∏‚£á‚£Ä‚£¥‚°æ‚†É‚¢Ä‚£Ñ‚£à‚†ô‚†õ‚†ì‚†Ä‚£∑‚†Ä‚¢π‚°Ü‚†Ä‚†Ä‚†Ä  ‚£¥‚†ü‚†â‚†ô‚¢ª‚£Ü‚†Ä"
    echo " ‚¢Ä‚£§‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚¢ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†ø‚¢ø‚£ø‚°ø‚†ø‚£ø‚£ø‚£ø‚£ø   ‚†Ä ‚†ô‚¢∑‚£Ñ‚£à‚†â‚†â‚†â‚£Å‚£†‚£∂‚£Ñ‚†â‚†õ‚†õ‚†ã‚†â‚¢Ä‚£†‚£æ‚£ø‚†Ä‚†â‚†â‚£Å‚£∏‚£ø‚°Ä‚¢∏‚£ø‚°á‚†à‚†â‚¢â‚£Ä‚£ø‚£ø‚†Ä‚†è‚¢†‚°Ñ‚†Ä‚¢†‚°ø‚†Å‚¢ø‚°Ñ‚†π‚†Ä‚†Ä‚¢ª‚†Ä‚°á‚†∏‚£∑‚£ø‚†Ä‚°á‚†ò‚†ã‚†â‚£â‚£†‚£Ñ‚£à‚†â‚†õ‚†õ‚†ø‚†ø‚†ø‚†ã‚¢†‚°æ‚†Å‚†Ä‚†Ä  ‚†Ä‚£ø‚°Ä‚†ò‚†É‚£†‚°ü‚†Ä"
    echo " ‚£ø‚°ø‚†õ‚†ø‚†ü‚†â‚†â‚†â‚†∏‚†ã‚†Ä‚†ª‚°ø‚£ø‚£ø‚£ø‚£ø‚†ª‚†á‚†Ä‚†Ä‚†à‚†Ä‚†Ä‚†à‚†â‚¢∏‚†É    ‚†Ä  ‚†â‚†õ‚†õ‚†õ‚†õ‚†ã‚†Å‚†Ä‚†ô‚†ø‚†∂‚†∂‚†∂‚†æ‚†õ‚†Å‚†Ä‚†õ‚†õ‚†õ‚†õ‚†õ‚†ã‚†π‚¢ß‚£§‚£§‚£§‚£§‚£ø‚†õ‚†õ‚†â‚£ª‚†Ü‚†Ä‚†§‚†Ñ‚¢Ä‚°ø‚†Å‚†Ä‚†à‚¢ø‚°Ä‚†Ä‚†É‚†à‚†Ä‚£ø‚°Ñ‚¢π‚£ø‚†Ä‚£ø‚†æ‚†ü‚†õ‚†ã‚†â‚†â‚†ô‚†ª‚†∑‚†∂‚†¶‚†§‚†¥‚†∂‚†õ‚†Å‚†Ä‚†Ä‚†Ä‚†Ä  ‚†à‚†ª‚†∂‚†æ‚†ü‚†Ä‚†Ä"
    echo " ‚†õ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†à‚¢ø‚¢ª‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä        ‚†Ä ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä       ‚†ª‚†∂‚†∂‚†∂‚†∂‚†æ‚†É‚†Ä‚†Ä‚†Ä‚†ò‚£∑‚°Ä‚†í‚†Ç‚†ê‚£ø‚£∑‚£Ä‚£Ä‚£Ä‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä"
    echo " ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†π‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä   ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä         ‚†ò‚†õ‚†õ‚†õ‚†õ‚†ã‚†à‚†â‚†â‚†â‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä"
    echo "=============================================================================================================================="
    echo "Cara penggunaan: ./pokemon_analysis.sh <namafile> [opsi]"
    echo "opsi:"
    echo "  -h, --help            Menampilkan display ini."
    echo "  -i, --info            Menampilkan pokemon dengan Usage dan RawUsage tertinggi."
    echo "  -s, --sort <metode>   Menyortir data sesuai metodenya masing masing secara descending."
    echo "                        Metode: name, usage, raw, hp, atk, def, spatk, spdef, speed."
    echo "  -g, --grep <nama>     Menampilkan info sesuai nama pokemon yang diberikan."
    echo "  -f, --filter <tipe>   Menampilkan pokemon yang memiliki tipe tertentu."
    echo "============================================="
    exit 0
fi

if [ "$opsi" = "-i" ] || [ "$opsi" = "--info" ]; then
    echo "========================================="
    echo "üèÜ Pokemon dengan Tingkat Penggunaan Tertinggi üèÜ "
    echo "========================================="

    awk -F',' 'NR > 1 { if ($2+0 > max1) { max1=$2+0; name1=$1 } if ($3+0 > max2) { max2=$3+0; name2=$1 } } \
    END { print "üî• Pokemon dengan Usage% tertinggi: "; print "Highest Adjusted Usage: " name1, max1 "%"; \
    print "‚ö° Pokemon dengan RawUsage tertinggi: "; print "Highest Raw Usage: " name2, max2 " uses" }' "$file"
    
    exit 0
fi

if [ "$opsi" = "-s" ] || [ "$opsi" = "--sort" ]; then
    if [ -z "$3" ]; then
        echo "Error: No sort method provided."
        exit 1
    fi
    metode="$3"
    declare -A pilihan
    pilihan=( [name]=1 [usage]=2 [raw]=3 [hp]=6 [atk]=7 [def]=8 [spatk]=9 [spdef]=10 [speed]=11 )
    
    if [[ -z "${pilihan[$metode]}" ]]; then
        echo "Error: Invalid sort method."
        exit 1
    fi
    
    col=${pilihan[$metode]}
    if [ "$metode" = "name" ]; then
        sort -t, -k${col},${col} -n "$file"
    else
        sort -t, -k${col},${col} -nr "$file"
    fi
    exit 0
fi

if [ "$opsi" = "-g" ] || [ "$opsi" = "--grep" ]; then
    if [ -z "$3" ]; then
        echo "Error: No Pokemon name provided."
        exit 1
    fi
    awk -F',' -v name="$3" 'NR==1 || tolower($1) ~ tolower(name)' "$file"
    exit 0
fi

if [ "$opsi" = "-f" ] || [ "$opsi" = "--filter" ]; then
    if [ -z "$3" ]; then
        echo "Error: No filter option provided."
        exit 1
    fi
    awk -F',' -v type="$3" 'NR > 1 && (tolower($4) == tolower(type) || tolower($5) == tolower(type))' "$file"
    exit 0
fi

echo "Error: no filter option provided"
echo "Use -h or --help for more information."
exit 1
